<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="本文将深入探讨Kubernetes（v1.21）核心概念，涵盖集群架构、Namespace、Pod等关键组件。">
<title>【kubernetes】3、Kubernetes（v1.21）概念</title>

<link rel='canonical' href='https://xxl999227.github.io/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/'>

<link rel="stylesheet" href="/scss/style.min.d91c2070e085e35f1fd5131bcadf95da720496f3d8c0dd302289c6e1955ee051.css"><meta property='og:title' content="【kubernetes】3、Kubernetes（v1.21）概念">
<meta property='og:description' content="本文将深入探讨Kubernetes（v1.21）核心概念，涵盖集群架构、Namespace、Pod等关键组件。">
<meta property='og:url' content='https://xxl999227.github.io/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/'>
<meta property='og:site_name' content='潇潇’s blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='kubernetes' /><meta property='article:published_time' content='2024-03-12T14:30:05&#43;08:00'/><meta property='article:modified_time' content='2024-03-12T14:30:05&#43;08:00'/><meta property='og:image' content='https://xxl999227.github.io/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image.png' />
<meta name="twitter:title" content="【kubernetes】3、Kubernetes（v1.21）概念">
<meta name="twitter:description" content="本文将深入探讨Kubernetes（v1.21）核心概念，涵盖集群架构、Namespace、Pod等关键组件。"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://xxl999227.github.io/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image.png' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_eb7a3547fa1b0d6b.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">❤️‍</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">潇潇’s blog</a></h1>
            <h2 class="site-description">欢迎来到我的网站，此博客由【Hugo &#43; Stack】来进行搭建，主要分享个人生活和学习笔记</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://xxl999227.github.io/'
                        target="_blank"
                        title="Gitee"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-home-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l-2 0l9 -9l9 9l-2 0" /><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" /><path d="M10 12h4v4h-4z" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/XXL999227'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友情链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span class="switch-model">暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
        <button class="back-to-top" id="scrollToTop" style="
            position: fixed; 
            bottom: 20px; 
            width: 40px; 
            height: 40px; 
            border-radius: 50%; 
            background-color: white; 
            border: 1px solid #ccc; 
            display: none; /* 初始隐藏 */
            align-items: center; 
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            color: #888;
        ">
            ↑
        </button>
        
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#第一章kubernetes-集群架构">第一章：Kubernetes 集群架构</a></li>
    <li><a href="#第二章资源管理方式">第二章：资源管理方式</a>
      <ol>
        <li><a href="#概述">概述</a></li>
        <li><a href="#命令式对象管理">命令式对象管理</a>
          <ol>
            <li><a href="#kubectl-命令">kubectl 命令</a></li>
            <li><a href="#font-stylecolorrgb38-38-38操作commandfont"><font style="color:rgb(38, 38, 38);">操作（command）</font></a></li>
            <li><a href="#font-stylecolorrgb38-38-38资源类型typefont"><font style="color:rgb(38, 38, 38);">资源类型（type）</font></a></li>
          </ol>
        </li>
        <li><a href="#font-stylecolorrgb38-38-38命令式对象配置font"><font style="color:rgb(38, 38, 38);">命令式对象配置</font></a></li>
        <li><a href="#声明式对象配置">声明式对象配置</a></li>
        <li><a href="#总结">总结</a></li>
        <li><a href="#故障排除必须记住">故障排除（必须记住）</a>
          <ol>
            <li><a href="#显示资源列表">显示资源列表</a></li>
            <li><a href="#显示有关资源的详细信息">显示有关资源的详细信息</a></li>
            <li><a href="#查询-pod-中的容器的打印日志">查询 Pod 中的容器的打印日志</a></li>
            <li><a href="#在-pod-中的容器环境内执行命令">在 Pod 中的容器环境内执行命令</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#第三章实战入门">第三章：实战入门</a>
      <ol>
        <li><a href="#namespace">Namespace</a></li>
        <li><a href="#font-stylecolorrgb51-51-51podfont"><font style="color:rgb(51, 51, 51);">Pod</font></a></li>
        <li><a href="#font-stylecolorrgb51-51-51labelfont"><font style="color:rgb(51, 51, 51);">Label</font></a></li>
        <li><a href="#font-stylecolorrgb51-51-51deploymentfont"><font style="color:rgb(51, 51, 51);">Deployment</font></a></li>
        <li><a href="#font-stylecolorrgb51-51-51servicefont"><font style="color:rgb(51, 51, 51);">Service</font></a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


<script>
    
    const scrollToTopButton = document.getElementById('scrollToTop');

    window.addEventListener('scroll', function() {
        if (window.scrollY > 0) {
            scrollToTopButton.style.display = 'flex';
        } else {
            scrollToTopButton.style.display = 'none';
        }
    });

    scrollToTopButton.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
</script>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/">
                <img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image.png"
                        
                        width="1000" 
                        height="250" 
                        loading="lazy"
                        alt="Featured image of post 【kubernetes】3、Kubernetes（v1.21）概念" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/kubernetes/" style="background-color: #30b8eebf; color: #fff;">
                Kubernetes
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/">【kubernetes】3、Kubernetes（v1.21）概念</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            本文将深入探讨Kubernetes（v1.21）核心概念，涵盖集群架构、Namespace、Pod等关键组件。
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">
                    创建时间：2024-03-12</time>
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-clock-hour-4"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M12 12l3 2" /><path d="M12 7v5" /></svg>
                <time class="article-time--lastUpdated">
                    更新时间：2024-03-12</time>
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-file-word"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2" /><path d="M9 12l1.333 5l1.667 -4l1.667 4l1.333 -5" /></svg>
                <time class="article-time--word">
                    字数总计：7855</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="第一章kubernetes-集群架构">第一章：Kubernetes 集群架构
</h2><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image-1.png"
	width="635"
	height="399"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="159"
		data-flex-basis="381px"
	
></p>
<ul>
<li>Docker 是每一个节点（包括 Master 节点和 Node 节点）的运行时环境（也有Containerd）。</li>
<li>kubelet 负责控制所有容器的启动和停止等，保证每个节点（包括 Master 节点和 Node 节点）正常工作，并且帮助 Node 节点和 Master 节点进行交互。</li>
<li>Master 节点的关键组件：
<ul>
<li>kubelet（监工）：所有节点必备的。控制当前节点所有 Pod 的生命周期以及与 api-server 交互等工作。</li>
<li>kube-api-server：负责接收所有请求。集群内对集群的任何修改都是通过命令行、UI 将请求发给 api-server 才能执行的。api-server 是整个集群操作对内、对外的唯一入口，不包含我们后来部署应用暴露端口的方式。</li>
<li>kube-proxy：整个节点的网络流量负责。</li>
<li>cri：容器运行时环境（如：Docker 、Podman 等）。</li>
<li>……</li>
</ul>
</li>
<li>Node 节点的关键组件：
<ul>
<li>kubelet（监工）：所有节点必备的。控制当前节点所有 Pod 的生命周期以及与 api-server 交互等工作。</li>
<li>kube-proxy：整个节点的网络流量负责。</li>
<li>cri：容器运行时环境（如：Docker 、Podman 等）。</li>
</ul>
</li>
</ul>
<h2 id="第二章资源管理方式">第二章：资源管理方式
</h2><h3 id="概述">概述
</h3><ul>
<li>① 命令式对象管理：直接通过命令去操作 Kubernetes 的资源。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl run nginx-pod --image<span class="o">=</span>nginx:1.17.1 --port<span class="o">=</span><span class="m">80</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>② 命令式对象配置：通过命令配置和配置文件去操作 Kubernetes 的资源。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create/patch/delete -f nginx-pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>③ 声明式对象配置：通过 apply 命令和配置文件去操作 Kubernetes 的资源。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f nginx-pod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>总结：</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>类型</th>
          <th>操作</th>
          <th>适用场景</th>
          <th>优点</th>
          <th>缺点</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>命令式对象管理</td>
          <td>对象</td>
          <td>测试</td>
          <td>简单</td>
          <td>只能操作活动对象，无法审计、跟踪</td>
      </tr>
      <tr>
          <td>命令式对象配置</td>
          <td>文件</td>
          <td>开发</td>
          <td>可以审计、跟踪</td>
          <td>项目大的时候，配置文件多，操作麻烦</td>
      </tr>
      <tr>
          <td>声明式对象配置</td>
          <td>目录</td>
          <td>开发</td>
          <td>支持目录操作</td>
          <td>意外情况下难以调试</td>
      </tr>
  </tbody>
</table></div>
<h3 id="命令式对象管理">命令式对象管理
</h3><h4 id="kubectl-命令">kubectl 命令
</h4><ul>
<li>kubectl 是 Kubernetes 集群的命令行工具，通过它能够对集群本身进行管理，并能够在集群上进行容器化应用的安装和部署。</li>
<li><a class="link" href="https://kubernetes.io/docs/reference/kubectl/"  target="_blank" rel="noopener"
    >kubectl</a> 命令的语法如下：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="o">[</span>command<span class="o">]</span> <span class="o">[</span>type<span class="o">]</span> <span class="o">[</span>name<span class="o">]</span> <span class="o">[</span>flags<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>参数：
<ul>
<li>command：指定要对资源执行的操作，如：create、get 、delete 等。</li>
<li>type：指定资源的类型，如：deployment 、pod 、service 等。</li>
<li>name：指定资源的名称，名称大小写敏感。</li>
<li>flags：指定额外的可选参数。</li>
</ul>
</li>
</ul>
<p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/2.gif"
	width="1192"
	height="769"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="372px"
	
></p>
<ul>
<li><font style="color:rgb(38, 38, 38);">示例：查看所有的 Pod</font></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get pod
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/3.gif"
	width="1195"
	height="772"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="371px"
	
></p>
</font>
<ul>
<li><font style="color:rgb(38, 38, 38);">示例：以 yaml 格式查看某个 Pod</font></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get pod 《pod_name》 -o yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/4.gif"
	width="1198"
	height="775"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
><font style="color:rgb(38, 38, 38);"><br>
</font></p>
<h4 id="font-stylecolorrgb38-38-38操作commandfont"><font style="color:rgb(38, 38, 38);">操作（command）</font>
</h4><ul>
<li><font style="color:rgb(38, 38, 38);">Kubernetes 允许对资源进行多种操作，可以通过 &ndash;help 查看详细的操作命令：</font></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl --help
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/2.gif"
	width="1192"
	height="769"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="372px"
	
></p>
<ul>
<li><font style="color:rgb(38, 38, 38);">经常使用的操作如下所示：</font></li>
<li><font style="color:rgb(38, 38, 38);">① 基本命令：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">命令</font></th>
          <th><font style="color:rgb(38, 38, 38);">翻译</font></th>
          <th><font style="color:rgb(38, 38, 38);">命令作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">create</font></td>
          <td><font style="color:rgb(38, 38, 38);">创建</font></td>
          <td><font style="color:rgb(38, 38, 38);">创建一个资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">edit</font></td>
          <td><font style="color:rgb(38, 38, 38);">编辑</font></td>
          <td><font style="color:rgb(38, 38, 38);">编辑一个资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">get</font></td>
          <td><font style="color:rgb(38, 38, 38);">获取</font></td>
          <td><font style="color:rgb(38, 38, 38);">获取一个资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">patch</font></td>
          <td><font style="color:rgb(38, 38, 38);">更新</font></td>
          <td><font style="color:rgb(38, 38, 38);">更新一个资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">delete</font></td>
          <td><font style="color:rgb(38, 38, 38);">删除</font></td>
          <td><font style="color:rgb(38, 38, 38);">删除一个资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">explain</font></td>
          <td><font style="color:rgb(38, 38, 38);">解释</font></td>
          <td><font style="color:rgb(38, 38, 38);">展示资源文档</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">② 运行和调试：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">命令</font></th>
          <th><font style="color:rgb(38, 38, 38);">翻译</font></th>
          <th><font style="color:rgb(38, 38, 38);">命令作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">run</font></td>
          <td><font style="color:rgb(38, 38, 38);">运行</font></td>
          <td><font style="color:rgb(38, 38, 38);">在集群中运行一个指定的镜像</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">expose</font></td>
          <td><font style="color:rgb(38, 38, 38);">暴露</font></td>
          <td><font style="color:rgb(38, 38, 38);">暴露资源为 Service</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">describe</font></td>
          <td><font style="color:rgb(38, 38, 38);">描述</font></td>
          <td><font style="color:rgb(38, 38, 38);">显示资源内部信息</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">logs</font></td>
          <td><font style="color:rgb(38, 38, 38);">日志</font></td>
          <td><font style="color:rgb(38, 38, 38);">输出容器在 Pod 中的日志</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">attach</font></td>
          <td><font style="color:rgb(38, 38, 38);">缠绕</font></td>
          <td><font style="color:rgb(38, 38, 38);">进入运行中的容器</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">exec</font></td>
          <td><font style="color:rgb(38, 38, 38);">执行</font></td>
          <td><font style="color:rgb(38, 38, 38);">执行容器中的一个命令</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">cp</font></td>
          <td><font style="color:rgb(38, 38, 38);">复制</font></td>
          <td><font style="color:rgb(38, 38, 38);">在 Pod 内外复制文件</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">rollout</font></td>
          <td><font style="color:rgb(38, 38, 38);">首次展示</font></td>
          <td><font style="color:rgb(38, 38, 38);">管理资源的发布</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">scale</font></td>
          <td><font style="color:rgb(38, 38, 38);">规模</font></td>
          <td><font style="color:rgb(38, 38, 38);">扩（缩）容 Pod 的数量</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">autoscale</font></td>
          <td><font style="color:rgb(38, 38, 38);">自动调整</font></td>
          <td><font style="color:rgb(38, 38, 38);">自动调整 Pod 的数量</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">③ 高级命令：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">命令</font></th>
          <th><font style="color:rgb(38, 38, 38);">翻译</font></th>
          <th><font style="color:rgb(38, 38, 38);">命令作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">apply</font></td>
          <td><font style="color:rgb(38, 38, 38);">应用</font></td>
          <td><font style="color:rgb(38, 38, 38);">通过文件对资源进行配置</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">label</font></td>
          <td><font style="color:rgb(38, 38, 38);">标签</font></td>
          <td><font style="color:rgb(38, 38, 38);">更新资源上的标签</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">④ 其他命令：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">命令</font></th>
          <th><font style="color:rgb(38, 38, 38);">翻译</font></th>
          <th><font style="color:rgb(38, 38, 38);">命令作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">cluster-info</font></td>
          <td><font style="color:rgb(38, 38, 38);">集群信息</font></td>
          <td><font style="color:rgb(38, 38, 38);">显示集群信息</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">version</font></td>
          <td><font style="color:rgb(38, 38, 38);">版本</font></td>
          <td><font style="color:rgb(38, 38, 38);">显示当前 Client 和 Server 的版本</font></td>
      </tr>
  </tbody>
</table></div>
<h4 id="font-stylecolorrgb38-38-38资源类型typefont"><font style="color:rgb(38, 38, 38);">资源类型（type）</font>
</h4><ul>
<li>Kubernetes 中所有的内容都抽象为资源，可以通过下面的命令进行查看：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl api-resources
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/6.gif"
	width="1194"
	height="771"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="371px"
	
></p>
<ul>
<li><font style="color:rgb(38, 38, 38);">经常使用的资源如下所示：</font></li>
<li><font style="color:rgb(38, 38, 38);">① 集群级别资源：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">资源名称</font></th>
          <th><font style="color:rgb(38, 38, 38);">缩写</font></th>
          <th><font style="color:rgb(38, 38, 38);">资源作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">nodes</font></td>
          <td><font style="color:rgb(38, 38, 38);">no</font></td>
          <td><font style="color:rgb(38, 38, 38);">集群组成部分</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">namespaces</font></td>
          <td><font style="color:rgb(38, 38, 38);">ns</font></td>
          <td><font style="color:rgb(38, 38, 38);">隔离 Pod</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">② Pod资源：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">资源名称</font></th>
          <th><font style="color:rgb(38, 38, 38);">缩写</font></th>
          <th><font style="color:rgb(38, 38, 38);">资源作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">Pods</font></td>
          <td><font style="color:rgb(38, 38, 38);">po</font></td>
          <td><font style="color:rgb(38, 38, 38);">装载容器</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">③ Pod资源控制器：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">资源名称</font></th>
          <th><font style="color:rgb(38, 38, 38);">缩写</font></th>
          <th><font style="color:rgb(38, 38, 38);">资源作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">replicationcontrollers</font></td>
          <td><font style="color:rgb(38, 38, 38);">rc</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">replicasets</font></td>
          <td><font style="color:rgb(38, 38, 38);">rs</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">deployments</font></td>
          <td><font style="color:rgb(38, 38, 38);">deploy</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">daemonsets</font></td>
          <td><font style="color:rgb(38, 38, 38);">ds</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">jobs</font></td>
          <td></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">cronjobs</font></td>
          <td><font style="color:rgb(38, 38, 38);">cj</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">horizontalpodautoscalers</font></td>
          <td><font style="color:rgb(38, 38, 38);">hpa</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">statefulsets</font></td>
          <td><font style="color:rgb(38, 38, 38);">sts</font></td>
          <td><font style="color:rgb(38, 38, 38);">控制 Pod 资源</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">④ 服务发现资源：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">资源名称</font></th>
          <th><font style="color:rgb(38, 38, 38);">缩写</font></th>
          <th><font style="color:rgb(38, 38, 38);">资源作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">services</font></td>
          <td><font style="color:rgb(38, 38, 38);">svc</font></td>
          <td><font style="color:rgb(38, 38, 38);">统一 Pod 对外接口</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">ingress</font></td>
          <td><font style="color:rgb(38, 38, 38);">ing</font></td>
          <td><font style="color:rgb(38, 38, 38);">统一 Pod 对外接口</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">⑤ 存储资源：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">资源名称</font></th>
          <th><font style="color:rgb(38, 38, 38);">缩写</font></th>
          <th><font style="color:rgb(38, 38, 38);">资源作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">volumeattachments</font></td>
          <td></td>
          <td><font style="color:rgb(38, 38, 38);">存储</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">persistentvolumes</font></td>
          <td><font style="color:rgb(38, 38, 38);">pv</font></td>
          <td><font style="color:rgb(38, 38, 38);">存储</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">persistentvolumeclaims</font></td>
          <td><font style="color:rgb(38, 38, 38);">pvc</font></td>
          <td><font style="color:rgb(38, 38, 38);">存储</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">⑥ 配置资源：</font></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><font style="color:rgb(38, 38, 38);">资源名称</font></th>
          <th><font style="color:rgb(38, 38, 38);">缩写</font></th>
          <th><font style="color:rgb(38, 38, 38);">资源作用</font></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">configmaps</font></td>
          <td><font style="color:rgb(38, 38, 38);">cm</font></td>
          <td><font style="color:rgb(38, 38, 38);">配置</font></td>
      </tr>
      <tr>
          <td><font style="color:rgb(38, 38, 38);">secrets</font></td>
          <td></td>
          <td><font style="color:rgb(38, 38, 38);">配置</font></td>
      </tr>
  </tbody>
</table></div>
<ul>
<li><font style="color:rgb(38, 38, 38);">示例：查询命名空间</font></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get ns
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/7.gif"
	width="1195"
	height="776"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="153"
		data-flex-basis="369px"
	
></p>
<ul>
<li><font style="color:rgb(38, 38, 38);">示例：创建命名空间</font></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create ns dev
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/8.gif"
	width="1195"
	height="777"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="153"
		data-flex-basis="369px"
	
></p>
<ul>
<li><font style="color:rgb(38, 38, 38);">示例：删除命名空间</font></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete ns dev
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/9.gif"
	width="1196"
	height="774"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
></p>
<h3 id="font-stylecolorrgb38-38-38命令式对象配置font"><font style="color:rgb(38, 38, 38);">命令式对象配置</font>
</h3><ul>
<li>命令式对象配置就是通过命令配置和配置文件去操作 Kubernetes 的资源。</li>
<li>命令式对象配置的方式操作资源，可以简单的认为：命令 + yaml 配置文件（里面是命令需要的各种参数）。</li>
<li>示例：</li>
<li>① 创建一个 nginxpod.yaml 文件，内容如下（第五行的三横杠 &mdash; 是yaml的结束标志，后面的可以理解为另一个yaml了）：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginxpod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.17.1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>② 执行 create 命令，创建资源：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create -f nginxpod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>③ 执行 get 命令，查看资源：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get -f nginxpod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>④ 执行 delete 命令，删除资源：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete -f nginxpod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/10.gif"
	width="1192"
	height="771"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="371px"
	
></p>
<h3 id="声明式对象配置">声明式对象配置
</h3><ul>
<li>
<p>声明式对象配置：通过 apply 命令和配置文件去操作 Kubernetes 的资源。</p>
</li>
<li>
<p>声明式对象配置和命令式对象配置类似，只不过它只有一个 apply 命令。</p>
</li>
<li>
<p>apply 命令相当于 create 命令和 patch 命令。</p>
</li>
<li>
<p>示例：</p>
</li>
<li>
<p>① 创建一个 nginxpod.yaml 文件，内容如下：</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginxpod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.17.1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>② 执行 apply 命令：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f nginxpod.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/11.gif"
	width="1193"
	height="778"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="153"
		data-flex-basis="368px"
	
></p>
<h3 id="总结">总结
</h3><ul>
<li><font style="color:#DF2A3F;">创建和更新资源使用声明式对象配置：kubectl apply -f xxx.yaml。</font></li>
<li><font style="color:#DF2A3F;">删除资源使用命令式对象配置：kubectl delete -f xxx.yaml。</font></li>
<li><font style="color:#DF2A3F;">查询资源使用命令式对象管理：kubectl get(describe) 资源名称。</font></li>
</ul>
<h3 id="故障排除必须记住">故障排除（必须记住）
</h3><h4 id="显示资源列表">显示资源列表
</h4><ul>
<li>命令：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get 资源类型
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>示例：获取类型为 Deployment 的资源列表</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get deployment
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/12.gif"
	width="1197"
	height="772"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="372px"
	
></p>
<ul>
<li>示例：获取类型为 Pod 的资源列表</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get pod
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/13.gif"
	width="1196"
	height="772"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="371px"
	
></p>
<ul>
<li>示例：获取类型为 Node 的资源列表</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get node
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/14.gif"
	width="1196"
	height="774"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
></p>
<ul>
<li>示例：显示所有名称空间下的 Deployment</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get deployment -A
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get deployment --all-namespaces
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/15.gif"
	width="1196"
	height="771"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="372px"
	
></p>
<ul>
<li>示例：查看 kube-system 名称空间下的 Deployment</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get deployment -n kube-system
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/16.gif"
	width="1193"
	height="773"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
></p>
<ul>
<li>示例：查看在名称空间下的资源对象</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl api-resources --namespaced<span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/17.gif"
	width="1194"
	height="763"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="375px"
	
></p>
<ul>
<li>示例：查询不在名称空间下的资源对象（理解：就是受 Kubernetes 集群统一调度，而不受到具体名称空间的约束）</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl api-resources --namespaced<span class="o">=</span><span class="nb">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/18.gif"
	width="1193"
	height="772"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
></p>
<h4 id="显示有关资源的详细信息">显示有关资源的详细信息
</h4><ul>
<li>命令：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl describe 资源类型 资源名称
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>示例：查询名称为 nginx-pod 的 Pod 的信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl describe pod nginxpod -n dev
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/19.gif"
	width="1196"
	height="775"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
></p>
<ul>
<li>示例：显示名称为 nginx 的 Deployment 的信息</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl describe deployment nginx
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/20.gif"
	width="1194"
	height="778"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="153"
		data-flex-basis="368px"
	
></p>
<h4 id="查询-pod-中的容器的打印日志">查询 Pod 中的容器的打印日志
</h4><ul>
<li>命令：类似于 Docker 的 <code>docker logs -f xxx</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl logs -f Pod名称
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>示例：查询名称为 nginxpod 的 Pod 日志</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl logs -f nginxpod -n dev
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/21.gif"
	width="1194"
	height="773"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="370px"
	
></p>
<h4 id="在-pod-中的容器环境内执行命令">在 Pod 中的容器环境内执行命令
</h4><ul>
<li>命令：类似于 Docker 的 <code>docker exec -it xxx /bin/bash</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it xxx -- /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>示例：在名称为 nginx-pod 的容器中执行命令</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it nginx-pod -- /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/22.gif"
	width="1194"
	height="775"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="154"
		data-flex-basis="369px"
	
></p>
<h2 id="第三章实战入门">第三章：实战入门
</h2><h3 id="namespace">Namespace
</h3><ol>
<li> Namespace是kubernetes系统中的一种非常重要资源，它的主要作用是用来实现<strong>多套环境的资源隔离</strong>或者<strong>多租户的资源隔离</strong>。</li>
<li> 默认情况下，kubernetes集群中的所有的Pod都是可以相互访问的。但是在实际中，可能不想让两个Pod之间进行互相的访问，那此时就可以将两个Pod划分到不同的namespace下。kubernetes通过将集群内部的资源分配到不同的Namespace中，可以形成逻辑上的&quot;组&quot;，以方便不同的组的资源进行隔离使用和管理。</li>
<li> 可以通过kubernetes的授权机制，将不同的namespace交给不同租户进行管理，这样就实现了多租户的资源隔离。此时还能结合kubernetes的资源配额机制，限定不同租户能占用的资源，例如CPU使用量、内存使用量等等，来实现租户可用资源的管理。</li>
<li> namespace资源隔离、网络不隔离，如：配置文件不可以跨namespace访问，但是网络访问可以跨名称空间访问。</li>
</ol>
<p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image-2.png"
	width="1097"
	height="567"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="193"
		data-flex-basis="464px"
	
></p>
<p>kubernetes在集群启动之后，会默认创建几个namespace</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl  get namespace</span>
</span></span><span class="line"><span class="cl">NAME              STATUS   AGE
</span></span><span class="line"><span class="cl">default           Active   45h     <span class="c1">#  所有未指定Namespace的对象都会被分配在default命名空间</span>
</span></span><span class="line"><span class="cl">kube-node-lease   Active   45h     <span class="c1">#  集群节点之间的心跳维护，v1.13开始引入</span>
</span></span><span class="line"><span class="cl">kube-public       Active   45h     <span class="c1">#  此命名空间下的资源可以被所有人访问（包括未认证用户）</span>
</span></span><span class="line"><span class="cl">kube-system       Active   45h     <span class="c1">#  所有由Kubernetes系统创建的资源都处于这个命名空间</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>下面来看namespace资源的具体操作：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 1 查看所有的ns  命令：kubectl get ns</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get ns</span>
</span></span><span class="line"><span class="cl">NAME              STATUS   AGE
</span></span><span class="line"><span class="cl">default           Active   45h
</span></span><span class="line"><span class="cl">kube-node-lease   Active   45h
</span></span><span class="line"><span class="cl">kube-public       Active   45h     
</span></span><span class="line"><span class="cl">kube-system       Active   45h     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2 查看指定的ns   命令：kubectl get ns ns名称</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get ns default</span>
</span></span><span class="line"><span class="cl">NAME      STATUS   AGE
</span></span><span class="line"><span class="cl">default   Active   45h
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3 指定输出格式  命令：kubectl get ns ns名称  -o 格式参数</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes支持的格式有很多，比较常见的是wide、json、yaml</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get ns default -o yaml</span>
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Namespace
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  creationTimestamp: <span class="s2">&#34;2020-04-05T04:44:16Z&#34;</span>
</span></span><span class="line"><span class="cl">  name: default
</span></span><span class="line"><span class="cl">  resourceVersion: <span class="s2">&#34;151&#34;</span>
</span></span><span class="line"><span class="cl">  selfLink: /api/v1/namespaces/default
</span></span><span class="line"><span class="cl">  uid: 7405f73a-e486-43d4-9db6-145f1409f090
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  finalizers:
</span></span><span class="line"><span class="cl">  - kubernetes
</span></span><span class="line"><span class="cl">status:
</span></span><span class="line"><span class="cl">  phase: Active
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># 4 查看ns详情  命令：kubectl describe ns ns名称</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl describe ns default</span>
</span></span><span class="line"><span class="cl">Name:         default
</span></span><span class="line"><span class="cl">Labels:       &lt;none&gt;
</span></span><span class="line"><span class="cl">Annotations:  &lt;none&gt;
</span></span><span class="line"><span class="cl">Status:       Active  <span class="c1"># Active 命名空间正在使用中  Terminating 正在删除命名空间</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ResourceQuota 针对namespace做的资源限制</span>
</span></span><span class="line"><span class="cl"><span class="c1"># LimitRange针对namespace中的每个组件做的资源限制</span>
</span></span><span class="line"><span class="cl">No resource quota.
</span></span><span class="line"><span class="cl">No LimitRange resource.
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>创建namespace</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># 创建namespace</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl create ns dev</span>
</span></span><span class="line"><span class="cl"><span class="n">namespace</span><span class="p">/</span><span class="n">dev</span> <span class="n">created</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>删除</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># 删除namespace</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl delete ns dev</span>
</span></span><span class="line"><span class="cl"><span class="n">namespace</span> <span class="s2">&#34;dev&#34;</span> <span class="n">deleted</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>配置方式</strong></p>
<p>首先准备一个yaml文件：ns-dev.yaml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Namespace</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>然后就可以执行对应的创建和删除命令了：</p>
<p>   创建：kubectl  create  -f  ns-dev.yaml</p>
<p>   删除：kubectl  delete  -f  ns-dev.yaml</p>
<h3 id="font-stylecolorrgb51-51-51podfont"><font style="color:rgb(51, 51, 51);">Pod</font>
</h3><p><font style="color:rgb(51, 51, 51);">Pod是kubernetes集群进行管理的最小单元，程序要运行必须</font><strong><font style="color:rgb(51, 51, 51);">部署在容器</font></strong><font style="color:rgb(51, 51, 51);">中，而容器必须存在于Pod中。</font></p>
<p><font style="color:rgb(51, 51, 51);">Pod可以认为是容器的封装，一个Pod中可以存在一个或者多个容器。</font></p>
<p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image-3.png"
	width="615"
	height="450"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="136"
		data-flex-basis="328px"
	
></p>
<p><font style="color:rgb(51, 51, 51);">kubernetes在集群启动之后，集群中的各个组件也都是以Pod方式运行的。可以通过下面命令查看：</font></p>
<p><strong><font style="color:rgb(51, 51, 51);">创建并运行</font></strong></p>
<p><font style="color:rgb(51, 51, 51);">kubernetes没有提供单独运行Pod的命令，都是通过Pod控制器来实现的</font></p>
<p><font style="color:#DF2A3F;">高版本的kubernetes创建的不是控制器，就是pod本身，可以通过kubectl create deployment   这种方式创建才有控制器，run是自由式创建，是没有控制器的，可以试试两种方式去创建nginx，用create deployment创建的nginx，用delete pod方法删了pod后会自动重启</font></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 命令格式： kubectl run (pod控制器名称) [参数] </span>
</span></span><span class="line"><span class="cl"><span class="c1"># --image  指定Pod的镜像</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --port   指定端口</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --namespace  指定namespace</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl run nginx --image=nginx:1.17.1 --port=80 --namespace dev </span>
</span></span><span class="line"><span class="cl">pod/nginx created
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">kubectl</span> <span class="n">create</span> <span class="n">deployment</span>  <span class="n">nginx</span> <span class="p">-</span><span class="n">-image</span><span class="p">=</span><span class="n">nginx</span><span class="err">:</span><span class="mf">1.17</span><span class="p">.</span><span class="py">1</span> <span class="p">-</span><span class="n">-port</span><span class="p">=</span><span class="mf">80</span> <span class="p">-</span><span class="n">-namespace</span> <span class="n">dev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#页面显示deployment.apps/nginx created</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">查看pod信息</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 查看Pod基本信息</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pods -n dev</span>
</span></span><span class="line"><span class="cl">NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-5ff7956ff6-fg2db   1/1     Running   <span class="m">0</span>          43s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看Pod的详细信息</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl describe pod nginx-5ff7956ff6-fg2db -n dev</span>
</span></span><span class="line"><span class="cl">Name:         nginx-5ff7956ff6-fg2db
</span></span><span class="line"><span class="cl">Namespace:    dev
</span></span><span class="line"><span class="cl">Priority:     <span class="m">0</span>
</span></span><span class="line"><span class="cl">Node:         node1/192.168.109.101
</span></span><span class="line"><span class="cl">Start Time:   Wed, <span class="m">08</span> Apr <span class="m">2020</span> 09:29:24 +0800
</span></span><span class="line"><span class="cl">Labels:       pod-template-hash<span class="o">=</span>5ff7956ff6
</span></span><span class="line"><span class="cl">              <span class="nv">run</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">Annotations:  &lt;none&gt;
</span></span><span class="line"><span class="cl">Status:       Running
</span></span><span class="line"><span class="cl">IP:           10.244.1.23
</span></span><span class="line"><span class="cl">IPs:
</span></span><span class="line"><span class="cl">  IP:           10.244.1.23
</span></span><span class="line"><span class="cl">Controlled By:  ReplicaSet/nginx-5ff7956ff6
</span></span><span class="line"><span class="cl">Containers:
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    Container ID:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c
</span></span><span class="line"><span class="cl">    Image:          nginx:1.17.1
</span></span><span class="line"><span class="cl">    Image ID:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7
</span></span><span class="line"><span class="cl">    Port:           80/TCP
</span></span><span class="line"><span class="cl">    Host Port:      0/TCP
</span></span><span class="line"><span class="cl">    State:          Running
</span></span><span class="line"><span class="cl">      Started:      Wed, <span class="m">08</span> Apr <span class="m">2020</span> 09:30:01 +0800
</span></span><span class="line"><span class="cl">    Ready:          True
</span></span><span class="line"><span class="cl">    Restart Count:  <span class="m">0</span>
</span></span><span class="line"><span class="cl">    Environment:    &lt;none&gt;
</span></span><span class="line"><span class="cl">    Mounts:
</span></span><span class="line"><span class="cl">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw <span class="o">(</span>ro<span class="o">)</span>
</span></span><span class="line"><span class="cl">Conditions:
</span></span><span class="line"><span class="cl">  Type              Status
</span></span><span class="line"><span class="cl">  Initialized       True
</span></span><span class="line"><span class="cl">  Ready             True
</span></span><span class="line"><span class="cl">  ContainersReady   True
</span></span><span class="line"><span class="cl">  PodScheduled      True
</span></span><span class="line"><span class="cl">Volumes:
</span></span><span class="line"><span class="cl">  default-token-hwvvw:
</span></span><span class="line"><span class="cl">    Type:        Secret <span class="o">(</span>a volume populated by a Secret<span class="o">)</span>
</span></span><span class="line"><span class="cl">    SecretName:  default-token-hwvvw
</span></span><span class="line"><span class="cl">    Optional:    <span class="nb">false</span>
</span></span><span class="line"><span class="cl">QoS Class:       BestEffort
</span></span><span class="line"><span class="cl">Node-Selectors:  &lt;none&gt;
</span></span><span class="line"><span class="cl">Tolerations:     node.kubernetes.io/not-ready:NoExecute <span class="k">for</span> 300s
</span></span><span class="line"><span class="cl">                 node.kubernetes.io/unreachable:NoExecute <span class="k">for</span> 300s
</span></span><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  Type    Reason     Age        From               Message
</span></span><span class="line"><span class="cl">  ----    ------     ----       ----               -------
</span></span><span class="line"><span class="cl">  Normal  Scheduled  &lt;unknown&gt;  default-scheduler  Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1
</span></span><span class="line"><span class="cl">  Normal  Pulling    4m11s      kubelet, node1     Pulling image <span class="s2">&#34;nginx:1.17.1&#34;</span>
</span></span><span class="line"><span class="cl">  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image <span class="s2">&#34;nginx:1.17.1&#34;</span>
</span></span><span class="line"><span class="cl">  Normal  Created    3m36s      kubelet, node1     Created container nginx
</span></span><span class="line"><span class="cl">  Normal  Started    3m36s      kubelet, node1     Started container nginx
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">访问Pod</font></strong></p>
<p><strong><font style="color:#DF2A3F;">1.21此版本下 pod不能直接在宿主机访问</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 获取podIP</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pods -n dev -o wide</span>
</span></span><span class="line"><span class="cl">NAME                     READY   STATUS    RESTARTS   AGE    IP             NODE    ... 
</span></span><span class="line"><span class="cl">nginx-5ff7956ff6-fg2db   1/1     Running   <span class="m">0</span>          190s   10.244.1.23   node1   ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#访问POD</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># curl http://10.244.1.23:80</span>
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">    &lt;p&gt;&lt;em&gt;Thank you <span class="k">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">删除指定Pod</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 删除指定Pod</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl delete pod nginx-5ff7956ff6-fg2db -n dev</span>
</span></span><span class="line"><span class="cl">pod <span class="s2">&#34;nginx-5ff7956ff6-fg2db&#34;</span> deleted
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 此时，显示删除Pod成功，但是再查询，发现又新产生了一个 </span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pods -n dev</span>
</span></span><span class="line"><span class="cl">NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-5ff7956ff6-jj4ng   1/1     Running   <span class="m">0</span>          21s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 这是因为当前Pod是由Pod控制器创建的，控制器会监控Pod状况，一旦发现Pod死亡，会立即重建</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 此时要想删除Pod，必须删除Pod控制器</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 先来查询一下当前namespace下的Pod控制器</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get deploy -n  dev</span>
</span></span><span class="line"><span class="cl">NAME    READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">nginx   1/1     <span class="m">1</span>            <span class="m">1</span>           9m7s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 接下来，删除此PodPod控制器</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl delete deploy nginx -n dev</span>
</span></span><span class="line"><span class="cl">deployment.apps <span class="s2">&#34;nginx&#34;</span> deleted
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 稍等片刻，再查询Pod，发现Pod被删除了</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pods -n dev</span>
</span></span><span class="line"><span class="cl">No resources found in dev namespace.
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">配置操作</font></strong></p>
<p><font style="color:rgb(51, 51, 51);">创建一个pod-nginx.yaml，内容如下：</font></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.17.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font style="color:rgb(51, 51, 51);">然后就可以执行对应的创建和删除命令了：</font></p>
<p><font style="color:rgb(51, 51, 51);">创建：kubectl create -f pod-nginx.yaml</font></p>
<p><font style="color:rgb(51, 51, 51);">删除：kubectl delete -f pod-nginx.yaml</font></p>
<h3 id="font-stylecolorrgb51-51-51labelfont"><font style="color:rgb(51, 51, 51);">Label</font>
</h3><p><font style="color:rgb(51, 51, 51);">Label是kubernetes系统中的一个重要概念。它的作用就是在资源上添加标识，用来对它们进行区分和选择。</font></p>
<p><font style="color:rgb(51, 51, 51);">Label的特点：</font></p>
<ul>
<li><font style="color:rgb(51, 51, 51);">一个Label会以key/value键值对的形式附加到各种对象上，如Node、Pod、Service等等</font></li>
<li><font style="color:rgb(51, 51, 51);">一个资源对象可以定义任意数量的Label ，同一个Label也可以被添加到任意数量的资源对象上去</font></li>
<li><font style="color:rgb(51, 51, 51);">Label通常在资源对象定义时确定，当然也可以在对象创建后动态添加或者删除</font></li>
</ul>
<p><font style="color:rgb(51, 51, 51);">可以通过Label实现资源的多维度分组，以便灵活、方便地进行资源分配、调度、配置、部署等管理工作。</font></p>
<p><font style="color:rgb(119, 119, 119);">一些常用的Label 示例如下：</font></p>
<ul>
<li><font style="color:rgb(119, 119, 119);">版本标签：&ldquo;version&rdquo;:&ldquo;release&rdquo;, &ldquo;version&rdquo;:&ldquo;stable&rdquo;&hellip;&hellip;</font></li>
<li><font style="color:rgb(119, 119, 119);">环境标签：&ldquo;environment&rdquo;:&ldquo;dev&rdquo;，&ldquo;environment&rdquo;:&ldquo;test&rdquo;，&ldquo;environment&rdquo;:&ldquo;pro&rdquo;</font></li>
<li><font style="color:rgb(119, 119, 119);">架构标签：&ldquo;tier&rdquo;:&ldquo;frontend&rdquo;，&ldquo;tier&rdquo;:&ldquo;backend&rdquo;</font></li>
</ul>
<p><font style="color:rgb(51, 51, 51);">标签定义完毕之后，还要考虑到标签的选择，这就要使用到Label Selector，即：</font></p>
<p><font style="color:rgb(51, 51, 51);">Label用于给某个资源对象定义标识</font></p>
<p><font style="color:rgb(51, 51, 51);">Label Selector用于查询和筛选拥有某些标签的资源对象</font></p>
<p><font style="color:rgb(51, 51, 51);">当前有两种Label Selector：</font></p>
<ul>
<li><font style="color:rgb(51, 51, 51);">基于等式的Label Selector</font></li>
</ul>
<p><font style="color:rgb(51, 51, 51);">name = slave: 选择所有包含Label中key=&ldquo;name&quot;且value=&ldquo;slave&quot;的对象env != production: 选择所有包括Label中的key=&ldquo;env&quot;且value不等于&quot;production&quot;的对象</font></p>
<ul>
<li><font style="color:rgb(51, 51, 51);">基于集合的Label Selector</font></li>
</ul>
<p><font style="color:rgb(51, 51, 51);">name in (master, slave): 选择所有包含Label中的key=&ldquo;name&quot;且value=&ldquo;master&quot;或&quot;slave&quot;的对象name not in (frontend): 选择所有包含Label中的key=&ldquo;name&quot;且value不等于&quot;frontend&quot;的对象</font></p>
<p><font style="color:rgb(51, 51, 51);">标签的选择条件可以使用多个，此时将多个Label Selector进行组合，使用逗号&rdquo;,&ldquo;进行分隔即可。例如：</font></p>
<p><font style="color:rgb(51, 51, 51);">		</font><font style="color:rgb(51, 51, 51);">name=slave，env!=production</font></p>
<p><font style="color:rgb(51, 51, 51);">		</font><font style="color:rgb(51, 51, 51);">name not in (frontend)，env!=production</font></p>
<p><strong><font style="color:rgb(51, 51, 51);">命令方式</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 为pod资源打标签</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl label pod nginx-pod version=1.0 -n dev</span>
</span></span><span class="line"><span class="cl">pod/nginx-pod labeled
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 为pod资源更新标签</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl label pod nginx-pod version=2.0 -n dev --overwrite</span>
</span></span><span class="line"><span class="cl">pod/nginx-pod labeled
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看标签</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pod nginx-pod  -n dev --show-labels</span>
</span></span><span class="line"><span class="cl">NAME        READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">nginx-pod   1/1     Running   <span class="m">0</span>          10m   <span class="nv">version</span><span class="o">=</span>2.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 筛选标签</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pod -n dev -l version=2.0  --show-labels</span>
</span></span><span class="line"><span class="cl">NAME        READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">nginx-pod   1/1     Running   <span class="m">0</span>          17m   <span class="nv">version</span><span class="o">=</span>2.0
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get pod -n dev -l version!=2.0 --show-labels</span>
</span></span><span class="line"><span class="cl">No resources found in dev namespace.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#删除标签</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl label pod nginx-pod version- -n dev</span>
</span></span><span class="line"><span class="cl">pod/nginx-pod labeled
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">配置方式</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.0&#34;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;test&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.17.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font style="color:rgb(51, 51, 51);">然后就可以执行对应的更新命令了：kubectl apply -f pod-nginx.yaml</font></p>
<p><font style="color:rgb(51, 51, 51);"></font></p>
<h3 id="font-stylecolorrgb51-51-51deploymentfont"><font style="color:rgb(51, 51, 51);">Deployment</font>
</h3><p><font style="color:rgb(51, 51, 51);">    在kubernetes中，Pod是最小的控制单元，但是kubernetes很少直接控制Pod，一般都是通过Pod控制器来完成的。Pod控制器用于pod的管理，确保pod资源符合预期的状态，当pod的资源出现故障时，会尝试进行重启或重建pod。</font></p>
<p><font style="color:rgb(51, 51, 51);">     在kubernetes中Pod控制器的种类有很多，本章节只介绍一种：Deployment。</font></p>
<p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image-4.png"
	width="765"
	height="422"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="181"
		data-flex-basis="435px"
	
></p>
<p><font style="color:rgb(51, 51, 51);">Deployment 控制器并不直接管理 Pod，而是通过管理 ReplicaSet 来间接管理 Pod ，即：Deployment 管理 ReplicaSet，ReplicaSet 管理 Pod 。所以 Deployment 的功能比 ReplicaSet 强大。</font></p>
<p><img src="/archives/kubernetes3kubernetesv1.21%E6%A6%82%E5%BF%B5/img/image-5.png"
	width="937"
	height="415"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="225"
		data-flex-basis="541px"
	
></p>
<p><strong>命令操作</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl create deployment nginx --image=nginx --port=80 --replicas=3 -n dev</span>
</span></span><span class="line"><span class="cl"><span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">nginx</span> <span class="n">created</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># 查看创建的deploy和Pod</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl get deploy,pods -n dev</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>                    <span class="n">READY</span>   <span class="nb">UP-TO</span><span class="n">-DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">deployment</span><span class="p">.</span><span class="n">apps</span><span class="p">/</span><span class="n">nginx</span>   <span class="mf">3</span><span class="p">/</span><span class="mf">3</span>     <span class="mf">3</span>            <span class="mf">3</span>           <span class="n">73s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>                         <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="p">/</span><span class="n">nginx</span><span class="p">-</span><span class="n">7848d4b86f-dnvkv</span>   <span class="mf">1</span><span class="p">/</span><span class="mf">1</span>     <span class="n">Running</span>   <span class="mf">0</span>          <span class="n">73s</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="p">/</span><span class="n">nginx</span><span class="p">-</span><span class="n">7848d4b86f-fkr8j</span>   <span class="mf">1</span><span class="p">/</span><span class="mf">1</span>     <span class="n">Running</span>   <span class="mf">0</span>          <span class="n">73s</span>
</span></span><span class="line"><span class="cl"><span class="n">pod</span><span class="p">/</span><span class="n">nginx</span><span class="p">-</span><span class="n">7848d4b86f-pff2q</span>   <span class="mf">1</span><span class="p">/</span><span class="mf">1</span>     <span class="n">Running</span>   <span class="mf">0</span>          <span class="n">73s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># UP-TO-DATE：成功升级的副本数量</span>
</span></span><span class="line"><span class="cl"><span class="c"># AVAILABLE：可用副本的数量</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl get deploy -n dev -o wide</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>    <span class="n">READY</span> <span class="nb">UP-TO</span><span class="n">-DATE</span>  <span class="n">AVAILABLE</span>   <span class="n">AGE</span>     <span class="n">CONTAINERS</span>   <span class="n">IMAGES</span>              <span class="n">SELECTOR</span>
</span></span><span class="line"><span class="cl"><span class="n">nginx</span>   <span class="mf">3</span><span class="p">/</span><span class="mf">3</span>     <span class="mf">3</span>         <span class="mf">3</span>           <span class="n">2m51s</span>   <span class="n">nginx</span>        <span class="n">nginx</span><span class="err">:</span><span class="mf">1.17</span><span class="p">.</span><span class="py">1</span>        <span class="n">run</span><span class="p">=</span><span class="n">nginx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># 查看deployment的详细信息</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl describe deploy nginx -n dev</span>
</span></span><span class="line"><span class="cl"><span class="n">Name</span><span class="err">:</span>                   <span class="n">nginx</span>
</span></span><span class="line"><span class="cl"><span class="n">Namespace</span><span class="err">:</span>              <span class="n">dev</span>
</span></span><span class="line"><span class="cl"><span class="n">CreationTimestamp</span><span class="err">:</span>      <span class="n">Tue</span><span class="p">,</span> <span class="mf">20</span> <span class="n">Feb</span> <span class="mf">2024</span> <span class="mf">23</span><span class="err">:</span><span class="mf">31</span><span class="err">:</span><span class="mf">41</span> <span class="mf">+0800</span>
</span></span><span class="line"><span class="cl"><span class="n">Labels</span><span class="err">:</span>                 <span class="n">app</span><span class="p">=</span><span class="n">nginx</span>
</span></span><span class="line"><span class="cl"><span class="n">Annotations</span><span class="err">:</span>            <span class="n">deployment</span><span class="p">.</span><span class="py">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="p">/</span><span class="n">revision</span><span class="err">:</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Selector</span><span class="err">:</span>               <span class="n">app</span><span class="p">=</span><span class="n">nginx</span>
</span></span><span class="line"><span class="cl"><span class="n">Replicas</span><span class="err">:</span>               <span class="mf">3</span> <span class="n">desired</span> <span class="p">|</span> <span class="mf">3</span> <span class="n">updated</span> <span class="p">|</span> <span class="mf">3</span> <span class="n">total</span> <span class="p">|</span> <span class="mf">3</span> <span class="n">available</span> <span class="p">|</span> <span class="mf">0</span> <span class="n">unavailable</span>
</span></span><span class="line"><span class="cl"><span class="n">StrategyType</span><span class="err">:</span>           <span class="n">RollingUpdate</span>
</span></span><span class="line"><span class="cl"><span class="n">MinReadySeconds</span><span class="err">:</span>        <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="n">RollingUpdateStrategy</span><span class="err">:</span>  <span class="mf">25</span><span class="p">%</span> <span class="n">max</span> <span class="n">unavailable</span><span class="p">,</span> <span class="mf">25</span><span class="p">%</span> <span class="n">max</span> <span class="n">surge</span>
</span></span><span class="line"><span class="cl"><span class="n">Pod</span> <span class="n">Template</span><span class="err">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">Labels</span><span class="err">:</span>  <span class="n">app</span><span class="p">=</span><span class="n">nginx</span>
</span></span><span class="line"><span class="cl">  <span class="n">Containers</span><span class="err">:</span>
</span></span><span class="line"><span class="cl">   <span class="n">nginx</span><span class="err">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Image</span><span class="err">:</span>        <span class="n">nginx</span>
</span></span><span class="line"><span class="cl">    <span class="n">Port</span><span class="err">:</span>         <span class="mf">80</span><span class="p">/</span><span class="n">TCP</span>
</span></span><span class="line"><span class="cl">    <span class="n">Host</span> <span class="n">Port</span><span class="err">:</span>    <span class="mf">0</span><span class="p">/</span><span class="n">TCP</span>
</span></span><span class="line"><span class="cl">    <span class="n">Environment</span><span class="err">:</span>  <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Mounts</span><span class="err">:</span>       <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="n">Volumes</span><span class="err">:</span>        <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">Conditions</span><span class="err">:</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Type </span>          <span class="n">Status</span>  <span class="n">Reason</span>
</span></span><span class="line"><span class="cl">  <span class="p">----</span>           <span class="p">------</span>  <span class="p">------</span>
</span></span><span class="line"><span class="cl">  <span class="n">Available</span>      <span class="n">True</span>    <span class="n">MinimumReplicasAvailable</span>
</span></span><span class="line"><span class="cl">  <span class="n">Progressing</span>    <span class="n">True</span>    <span class="n">NewReplicaSetAvailable</span>
</span></span><span class="line"><span class="cl"><span class="n">OldReplicaSets</span><span class="err">:</span>  <span class="p">&lt;</span><span class="n">none</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">NewReplicaSet</span><span class="err">:</span>   <span class="n">nginx</span><span class="p">-</span><span class="n">7848d4b86f</span> <span class="p">(</span><span class="mf">3</span><span class="p">/</span><span class="mf">3</span> <span class="n">replicas</span> <span class="n">created</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Events</span><span class="err">:</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Type </span>   <span class="n">Reason</span>             <span class="n">Age</span>    <span class="n">From</span>                   <span class="n">Message</span>
</span></span><span class="line"><span class="cl">  <span class="p">----</span>    <span class="p">------</span>             <span class="p">----</span>   <span class="p">----</span>                   <span class="p">-------</span>
</span></span><span class="line"><span class="cl">  <span class="n">Normal</span>  <span class="n">ScalingReplicaSet</span>  <span class="n">3m13s</span>  <span class="nb">deployment-controller</span>  <span class="n">Scaled</span> <span class="n">up</span> <span class="n">replica</span> <span class="nb">set </span><span class="n">nginx</span><span class="p">-</span><span class="n">7848d4b86f</span> <span class="n">to</span> <span class="mf">3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># 删除 </span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">root</span><span class="nv">@master</span> <span class="p">~]</span><span class="c"># kubectl delete deploy nginx -n dev</span>
</span></span><span class="line"><span class="cl"><span class="n">deployment</span><span class="p">.</span><span class="py">apps</span> <span class="s2">&#34;nginx&#34;</span> <span class="n">deleted</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>配置操作</strong></p>
<p><font style="color:rgb(51, 51, 51);">创建一个deploy-nginx.yaml，内容如下：</font></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w"> </span><span class="c"># 版本号 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w"> </span><span class="c"># 类型 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># 元数据 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># rs名称 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w"> </span><span class="c"># 所属命名空间 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c">#标签 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">controller</span><span class="p">:</span><span class="w"> </span><span class="l">deploy </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># 详情描述 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># 副本数量 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># 保留历史版本，默认为10 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">paused</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c"># 暂停部署，默认是false </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">progressDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">600</span><span class="w"> </span><span class="c"># 部署超时时间（s），默认是600 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="c"># 策略 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w"> </span><span class="c"># 滚动更新策略 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w"> </span><span class="c"># 滚动更新 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxSurge: 30% # 最大额外可以存在的副本数，可以为百分比，也可以为整数 maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="l">%</span><span class="w"> </span><span class="c"># 最大不可用状态的    Pod 的最大值，可以为百分比，也可以为整数 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="c"># 选择器，通过它指定该控制器管理哪些pod </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"> </span><span class="c"># Labels匹配规则 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-pod </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="c"># 模板，当副本数量不足时，会根据下面的模板创建pod副本 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-pod </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.17.1 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font style="color:rgb(51, 51, 51);">然后就可以执行对应的创建和删除命令了：</font></p>
<p><font style="color:rgb(51, 51, 51);">    创建：kubectl  create  -f  deploy-nginx.yaml</font></p>
<p><font style="color:rgb(51, 51, 51);">    删除：kubectl  delete  -f  deploy-nginx.yaml</font></p>
<p><font style="color:rgb(51, 51, 51);"></font></p>
<h3 id="font-stylecolorrgb51-51-51servicefont"><font style="color:rgb(51, 51, 51);">Service</font>
</h3><p><font style="color:rgb(51, 51, 51);">通过上节课的学习，已经能够利用Deployment来创建一组Pod来提供具有高可用性的服务。</font></p>
<p><font style="color:rgb(51, 51, 51);">虽然每个Pod都会分配一个单独的Pod IP，然而却存在如下两问题：</font></p>
<ul>
<li><font style="color:rgb(51, 51, 51);">Pod IP 会随着Pod的重建产生变化</font></li>
<li><font style="color:rgb(51, 51, 51);">Pod IP 仅仅是集群内可见的虚拟IP，外部无法访问</font></li>
</ul>
<p><font style="color:rgb(51, 51, 51);">这样对于访问这个服务带来了难度。因此，kubernetes设计了Service来解决这个问题。</font></p>
<p><font style="color:rgb(51, 51, 51);">Service可以看作是一组同类Pod</font><strong><font style="color:rgb(51, 51, 51);">对外的访问接口</font></strong><font style="color:rgb(51, 51, 51);">。借助Service，应用可以方便地实现服务发现和负载均衡。</font></p>
<p><strong><font style="color:rgb(51, 51, 51);">操作一：创建集群内部可访问的Service</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 暴露Service</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev</span>
</span></span><span class="line"><span class="cl">service/svc-nginx1 exposed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看service</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get svc svc-nginx1 -n dev -o wide</span>
</span></span><span class="line"><span class="cl">NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>   AGE     SELECTOR
</span></span><span class="line"><span class="cl">svc-nginx1   ClusterIP   10.96.57.211   &lt;none&gt;        80/TCP    50s   <span class="nv">app</span><span class="o">=</span>nginx-pod
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 这里产生了一个CLUSTER-IP，这就是service的IP，在Service的生命周期中，这个地址是不会变动的</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 可以通过这个IP访问当前service对应的POD</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># curl 10.109.179.231:80</span>
</span></span><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">&lt;head&gt;
</span></span><span class="line"><span class="cl">&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span class="line"><span class="cl">&lt;/head&gt;
</span></span><span class="line"><span class="cl">&lt;body&gt;
</span></span><span class="line"><span class="cl">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span class="line"><span class="cl">.......
</span></span><span class="line"><span class="cl">&lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">操作二：创建集群外部也可访问的Service</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl"># 上面创建的Service的type类型为ClusterIP，这个ip地址只用集群内部可访问
</span></span><span class="line"><span class="cl"># 如果需要创建外部也可以访问的Service，需要修改type为NodePort
</span></span><span class="line"><span class="cl">[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev
</span></span><span class="line"><span class="cl">service/svc-nginx2 exposed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 此时查看，会发现出现了NodePort类型的Service，而且有一对Port（80:31928/TC）
</span></span><span class="line"><span class="cl">[root@master ~]# kubectl get svc  svc-nginx-2  -n dev -o wide
</span></span><span class="line"><span class="cl">NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR
</span></span><span class="line"><span class="cl">svc-nginx2    NodePort    10.100.94.0      &lt;none&gt;        80:31928/TCP   9s     run=nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 接下来就可以通过集群外的主机访问 节点IP:31928访问服务了
</span></span><span class="line"><span class="cl"># 例如在的电脑主机上通过浏览器访问下面的地址
</span></span><span class="line"><span class="cl">http://192.168.109.100:31928/
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">删除Service</font></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-plain" data-lang="plain"><span class="line"><span class="cl">[root@master ~]# kubectl delete svc svc-nginx1 -n dev   
</span></span><span class="line"><span class="cl">service &#34;svc-nginx1&#34; deleted
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><font style="color:rgb(51, 51, 51);">配置方式</font></strong></p>
<p><font style="color:rgb(51, 51, 51);">创建一个svc-nginx.yaml，内容如下：</font></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">svc-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="m">10.109.179.231</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><font style="color:rgb(51, 51, 51);">然后就可以执行对应的创建和删除命令了：</font></p>
<p><font style="color:rgb(51, 51, 51);">创建：kubectl create -f svc-nginx.yaml</font></p>
<p><font style="color:rgb(51, 51, 51);">删除：kubectl delete -f svc-nginx.yaml</font></p>
<p><strong><font style="color:rgb(119, 119, 119);">小结</font></strong></p>
<blockquote>
<p><font style="color:rgb(119, 119, 119);">至此，已经掌握了Namespace、Pod、Deployment、Service资源的基本操作，有了这些操作，就可以在kubernetes集群中实现一个服务的简单部署和访问了，但是如果想要更好的使用kubernetes，就需要深入学习这几种资源的细节和原理。</font></p></blockquote>
<p>后续k8s详解可以看：</p>
<p><a class="link" href="https://www.yuque.com/fairy-era/yg511q/lmy7gc#9d0a1c8b"  target="_blank" rel="noopener"
    >https://www.yuque.com/fairy-era/yg511q/lmy7gc#9d0a1c8b</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/kubernetes/">Kubernetes</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/archives/kubernetes2%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAk8skubeadm%E6%96%B9%E5%BC%8F/">
        
        

        <div class="article-details">
            <h2 class="article-title">【kubernetes】2、集群环境搭建k8s(kubeadm方式)</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/archives/kubernetes1kubernetes%E4%BB%8B%E7%BB%8D/">
        
        
            <div class="article-image">
                <img src="/archives/kubernetes1kubernetes%E4%BB%8B%E7%BB%8D/img/image.37352077f9455725c58b602276ce326f.png" 
                        width="1000" 
                        height="250" 
                        loading="lazy"
                        alt="Featured image of post 【kubernetes】1、kubernetes介绍"
                        
                        data-hash="md5-NzUgd/lFVyXFi2Aids4ybw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【kubernetes】1、kubernetes介绍</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="XXL999227/XXL999227.github.io"
    data-repo-id="R_kgDOINqX4g"
    data-category="General"
    data-category-id="DIC_kwDOINqX4s4CiTUd"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2025 Powered by 潇潇
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script>
    
    const cssPath = "https://xxl999227.github.io/waifu/waifu.css";
    const tipsJsonPath = "https://xxl999227.github.io/waifu/waifu-tips.json";
    const myTipsJsonPath = "https://xxl999227.github.io/waifu/my-waifu-tips.js";
    const gamePath = "https://xxl999227.github.io/waifu/asteroids.js";
    
    const live2d_path = "https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/";
    const live2dMinJsPath = "https://xxl999227.github.io/waifu/live2d.min.js";

    
    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            }
            else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }

    
    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(cssPath, "css"),
            loadExternalResource(live2dMinJsPath, "js"),
            loadExternalResource(myTipsJsonPath, "js")
        ]).then(() => {
            
            initWidget({
                waifuPath: tipsJsonPath,
                gamePath: gamePath,
                cdnPath: "https://cdn.jsdelivr.net/gh/XXL999227/static-resource@v1.0.0",
                tools: ["hitokoto", "asteroids", "switch-model", "switch-texture", "photo", "quit"]
             
            });
            
            initWaifuMouseEvent();
        });
    }

    function initWaifuMouseEvent() {
        const waifu = document.getElementById("waifu");
        let isDown = false;
        let waifuLeft;
        let mouseLeft;
        let waifuTop;
        let mouseTop;
        
        waifu.onmousedown = function (e) {
            isDown = true;
            
            waifuLeft = waifu.offsetLeft;
            mouseLeft = e.clientX;
            
            waifuTop = waifu.offsetTop;
            mouseTop = e.clientY;
        }
        
        window.onmousemove = function (e) {
            if (!isDown) {
                return;
            }
            
            let currentLeft = waifuLeft + (e.clientX - mouseLeft);
            if (currentLeft < 0) {
                currentLeft = 0;
            } else if (currentLeft > window.innerWidth - 300) {
                currentLeft = window.innerWidth - 300;
            }
            waifu.style.left = currentLeft  + "px";
            
            let currentTop = waifuTop + (e.clientY - mouseTop);
            if (currentTop < 30) {
                currentTop = 30
            } else if (currentTop > window.innerHeight - 290) {
                currentTop = window.innerHeight - 290
            }
            waifu.style.top = currentTop + "px";
        }
        
        window.onmouseup = function (e) {
            isDown = false;
        }
    }
</script>

<script src= https://xxl999227.github.io/background/particles/particles.js></script>

<link rel="stylesheet" href= https://xxl999227.github.io/background/particles/style.css>


<div id="particles-js"></div>

<script>
    

    particlesJS.load('particles-js', "https://xxl999227.github.io/background/particles/particlesjs-config.json", function() {
        console.log('particles.js loaded - callback');
    });
</script>
    </body>
</html>
